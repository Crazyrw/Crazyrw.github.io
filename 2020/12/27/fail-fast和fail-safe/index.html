

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="æ¢¦æƒ³å¾ˆçè´µï¼ŒåŠªåŠ›ç‰¹åˆ«é…·ã€‚-xback">
  <meta name="author" content="Crazyrw">
  <meta name="keywords" content="">
  <title>fail-fastå’Œfail-safe - Crazyrw&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"copy_btn":true,"image_zoom":{"enable":true},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":true,"baidu":"7d2fd3d56f2287a0bda354d214258de6","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Crazyrw's Blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/images/bg/post.webp') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="fail-fastå’Œfail-safe">
              
            </span>

            <p class="h2"><a id="rainbow" href=''>ğŸŒˆ è·å–ä¸­...</a></p>
            <script>
              fetch('https://api.eatrice.top')
                .then(response => response.json())
                .then(data => {
                  var rainbow = document.getElementById('rainbow');
                  rainbow.innerHTML = data.Content;
                  rainbow.href = "https://rainbow.eatrice.top/?ID=" + data.ID;
                })
                .catch(console.error)
              </script>


            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-12-27 16:26" pubdate>
        December 27, 2020 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.4k å­—
    </span>
  

  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">fail-fastå’Œfail-safe</h1>
            
              <p class="note note-info">
                
                  æœ¬æ–‡æœ€åæ›´æ–°äºï¼š6 days ago
                
              </p>
            
            <div class="markdown-body">
              <p>fail-fastä¸fasy-safeã€‚</p>
<p>åœ¨Collectioné›†åˆçš„å„ä¸ªç±»ä¸­ï¼Œæœ‰çº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹ä¸å®‰å…¨ä¸¤ç±»ã€‚</p>
<p>å¯¹äºçº¿ç¨‹ä¸å®‰å…¨çš„ç±»ï¼Œå¹¶å‘æƒ…å†µä¸‹å¯èƒ½ä¼šå‡ºç°fail-fastæƒ…å†µï¼›è€Œçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œå¯èƒ½ä¼šå‡ºç°fail-safeçš„æƒ…å†µã€‚</p>
<p><strong>å¹¶å‘ä¿®æ”¹ï¼š</strong></p>
<p>å½“ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹æ­£åœ¨éå†ä¸€ä¸ªé›†åˆCollectionçš„æ—¶å€™ï¼Œè€Œæ­¤æ—¶å¦ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªé›†åˆçš„å†…å®¹ï¼ˆå¦‚æ·»åŠ ã€åˆ é™¤æˆ–è€…ä¿®æ”¹ï¼‰ã€‚è¿™å°±æ˜¯å¹¶å‘ä¿®æ”¹çš„æƒ…å†µã€‚</p>
<h2 id="1-fail-fast"><a href="#1-fail-fast" class="headerlink" title="1. fail-fast"></a>1. fail-fast</h2><p>fail-fastæœºåˆ¶ï¼šå½“éå†ä¸€ä¸ªé›†åˆå¯¹è±¡æ—¶ï¼Œå¦‚æœé›†åˆå¯¹è±¡çš„ç»“æ„è¢«ä¿®æ”¹äº†ï¼Œå°±ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ã€‚</p>
<p><strong>æµ‹è¯•ï¼š(ä¸‹é¢æ˜¯å•çº¿ç¨‹çš„æƒ…å†µï¼Œå…¶å®å¤šçº¿ç¨‹æ˜¯ç±»ä¼¼çš„)</strong></p>
<pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Iterator;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestCoding</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        List&lt;Integer&gt; list1 = <span class="hljs-keyword">new</span> ArrayList&lt;Integer&gt;();
        list1.add(<span class="hljs-number">18</span>);
        list1.add(<span class="hljs-number">20</span>);
        list1.add(<span class="hljs-number">30</span>);
        list1.add(<span class="hljs-number">40</span>);
        Iterator&lt;Integer&gt; it = list1.iterator();

        <span class="hljs-keyword">while</span> (it.hasNext())&#123;
            Integer integer = it.next();
            <span class="hljs-keyword">if</span>(integer == <span class="hljs-number">20</span>)&#123;
                list1.remove(integer);
            &#125;
        &#125;

    &#125;
&#125;</code></pre>

<img src="/images/fail-fastå’Œfail-safe/image-20201227184015970.png" srcset="/img/loading.gif" alt="image-20201227184015970" style="zoom:80%;" />

<p><strong>åŸå› åˆ†æï¼š</strong></p>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹Iteratorçš„æºç ã€‚</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> java.util;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractList</span>&lt;<span class="hljs-title">E</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractCollection</span>&lt;<span class="hljs-title">E</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">List</span>&lt;<span class="hljs-title">E</span>&gt; </span>&#123;

    ...

        <span class="hljs-comment">// AbstractListä¸­å”¯ä¸€çš„å±æ€§</span>
        <span class="hljs-comment">// ç”¨æ¥è®°å½•Listä¿®æ”¹çš„æ¬¡æ•°ï¼šæ¯ä¿®æ”¹ä¸€æ¬¡(æ·»åŠ /åˆ é™¤ç­‰æ“ä½œ)ï¼Œå°†modCount+1</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">int</span> modCount = <span class="hljs-number">0</span>;

    <span class="hljs-comment">// è¿”å›Listå¯¹åº”è¿­ä»£å™¨ã€‚å®é™…ä¸Šï¼Œæ˜¯è¿”å›Itrå¯¹è±¡ã€‚</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Iterator&lt;E&gt; <span class="hljs-title">iterator</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Itr();
    &#125;

    <span class="hljs-comment">// Itræ˜¯Iterator(è¿­ä»£å™¨)çš„å®ç°ç±»</span>
    <span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Itr</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Iterator</span>&lt;<span class="hljs-title">E</span>&gt; </span>&#123;
        <span class="hljs-keyword">int</span> cursor = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">int</span> lastRet = -<span class="hljs-number">1</span>;

        <span class="hljs-comment">// ä¿®æ”¹æ•°çš„è®°å½•å€¼ã€‚</span>
        <span class="hljs-comment">// æ¯æ¬¡æ–°å»ºItr()å¯¹è±¡æ—¶ï¼Œéƒ½ä¼šä¿å­˜æ–°å»ºè¯¥å¯¹è±¡æ—¶å¯¹åº”çš„modCountï¼›</span>
        <span class="hljs-comment">// ä»¥åæ¯æ¬¡éå†Listä¸­çš„å…ƒç´ çš„æ—¶å€™ï¼Œéƒ½ä¼šæ¯”è¾ƒexpectedModCountå’ŒmodCountæ˜¯å¦ç›¸ç­‰ï¼›</span>
        <span class="hljs-comment">// è‹¥ä¸ç›¸ç­‰ï¼Œåˆ™æŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ï¼Œäº§ç”Ÿfail-fastäº‹ä»¶ã€‚</span>
        <span class="hljs-keyword">int</span> expectedModCount = modCount;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasNext</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">return</span> cursor != size();
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">next</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-comment">// è·å–ä¸‹ä¸€ä¸ªå…ƒç´ ä¹‹å‰ï¼Œéƒ½ä¼šåˆ¤æ–­â€œæ–°å»ºItrå¯¹è±¡æ—¶ä¿å­˜çš„modCountâ€å’Œâ€œå½“å‰çš„modCountâ€æ˜¯å¦ç›¸ç­‰ï¼›</span>
            <span class="hljs-comment">// è‹¥ä¸ç›¸ç­‰ï¼Œåˆ™æŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ï¼Œäº§ç”Ÿfail-fastäº‹ä»¶ã€‚</span>
            checkForComodification();
            <span class="hljs-keyword">try</span> &#123;
                E next = get(cursor);
                lastRet = cursor++;
                <span class="hljs-keyword">return</span> next;
            &#125; <span class="hljs-keyword">catch</span> (IndexOutOfBoundsException e) &#123;
                checkForComodification();
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();
            &#125;
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">if</span> (lastRet == -<span class="hljs-number">1</span>)
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException();
            checkForComodification();

            <span class="hljs-keyword">try</span> &#123;
                AbstractList.<span class="hljs-keyword">this</span>.remove(lastRet);
                <span class="hljs-keyword">if</span> (lastRet &lt; cursor)
                    cursor--;
                lastRet = -<span class="hljs-number">1</span>;
                expectedModCount = modCount;
            &#125; <span class="hljs-keyword">catch</span> (IndexOutOfBoundsException e) &#123;
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConcurrentModificationException();
            &#125;
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkForComodification</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">if</span> (modCount != expectedModCount)
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConcurrentModificationException();
        &#125;
    &#125;

    ...
&#125;</code></pre>

<p>ä»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°åœ¨è°ƒç”¨ next() å’Œ remove()æ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œ checkForComodification()ã€‚è‹¥ â€œ<strong>modCount ä¸ç­‰äº expectedModCount</strong>â€ï¼Œåˆ™æŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ï¼Œäº§ç”Ÿfail-fastäº‹ä»¶ã€‚</p>
<p>è¦ææ˜ç™½ fail-fastæœºåˆ¶ï¼Œæˆ‘ä»¬å°±è¦éœ€è¦ç†è§£ä»€ä¹ˆæ—¶å€™â€œmodCount ä¸ç­‰äº expectedModCountâ€ï¼<br>ä»Itrç±»ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ expectedModCount åœ¨åˆ›å»ºItrå¯¹è±¡æ—¶ï¼Œè¢«èµ‹å€¼ä¸º modCountï¼Œé™¤æ­¤ä¹‹å¤–å…¶ä»–ä»»ä½•æƒ…å†µï¼ŒexpectedModCount éƒ½ä¸ä¼šè¢«ä¿®æ”¹ã€‚é€šè¿‡Itrï¼Œæˆ‘ä»¬çŸ¥é“ï¼šexpectedModCountä¸å¯èƒ½è¢«ä¿®æ”¹ä¸ºä¸ç­‰äº modCountã€‚æ‰€ä»¥ï¼Œéœ€è¦è€ƒè¯çš„å°±æ˜¯modCountä½•æ—¶ä¼šè¢«ä¿®æ”¹ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ArrayListçš„æºç ï¼Œçœ‹çœ‹modCountæ˜¯å¦‚ä½•è¢«ä¿®æ”¹çš„ï¼š</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> java.util;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArrayList</span>&lt;<span class="hljs-title">E</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractList</span>&lt;<span class="hljs-title">E</span>&gt;</span>
<span class="hljs-class">    <span class="hljs-keyword">implements</span> <span class="hljs-title">List</span>&lt;<span class="hljs-title">E</span>&gt;, <span class="hljs-title">RandomAccess</span>, <span class="hljs-title">Cloneable</span>, <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span></span>
<span class="hljs-class"></span>&#123;

    ...

        <span class="hljs-comment">// listä¸­å®¹é‡å˜åŒ–æ—¶ï¼Œå¯¹åº”çš„åŒæ­¥å‡½æ•°</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ensureCapacity</span><span class="hljs-params">(<span class="hljs-keyword">int</span> minCapacity)</span> </span>&#123;
        modCount++;
        <span class="hljs-keyword">int</span> oldCapacity = elementData.length;
        <span class="hljs-keyword">if</span> (minCapacity &gt; oldCapacity) &#123;
            Object oldData[] = elementData;
            <span class="hljs-keyword">int</span> newCapacity = (oldCapacity * <span class="hljs-number">3</span>)/<span class="hljs-number">2</span> + <span class="hljs-number">1</span>;
            <span class="hljs-keyword">if</span> (newCapacity &lt; minCapacity)
                newCapacity = minCapacity;
            <span class="hljs-comment">// minCapacity is usually close to size, so this is a win:</span>
            elementData = Arrays.copyOf(elementData, newCapacity);
        &#125;
    &#125;


    <span class="hljs-comment">// æ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—æœ€å</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span> </span>&#123;
        <span class="hljs-comment">// ä¿®æ”¹modCount</span>
        ensureCapacity(size + <span class="hljs-number">1</span>);  <span class="hljs-comment">// Increments modCount!!</span>
        elementData[size++] = e;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    &#125;


    <span class="hljs-comment">// æ·»åŠ å…ƒç´ åˆ°æŒ‡å®šçš„ä½ç½®</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index, E element)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (index &gt; size || index &lt; <span class="hljs-number">0</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IndexOutOfBoundsException(
            <span class="hljs-string">&quot;Index: &quot;</span>+index+<span class="hljs-string">&quot;, Size: &quot;</span>+size);

        <span class="hljs-comment">// ä¿®æ”¹modCount</span>
        ensureCapacity(size+<span class="hljs-number">1</span>);  <span class="hljs-comment">// Increments modCount!!</span>
        System.arraycopy(elementData, index, elementData, index + <span class="hljs-number">1</span>,
                         size - index);
        elementData[index] = element;
        size++;
    &#125;

    <span class="hljs-comment">// æ·»åŠ é›†åˆ</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">addAll</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;
        Object[] a = c.toArray();
        <span class="hljs-keyword">int</span> numNew = a.length;
        <span class="hljs-comment">// ä¿®æ”¹modCount</span>
        ensureCapacity(size + numNew);  <span class="hljs-comment">// Increments modCount</span>
        System.arraycopy(a, <span class="hljs-number">0</span>, elementData, size, numNew);
        size += numNew;
        <span class="hljs-keyword">return</span> numNew != <span class="hljs-number">0</span>;
    &#125;


    <span class="hljs-comment">// åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ </span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">remove</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;
        RangeCheck(index);

        <span class="hljs-comment">// ä¿®æ”¹modCount</span>
        modCount++;
        E oldValue = (E) elementData[index];

        <span class="hljs-keyword">int</span> numMoved = size - index - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (numMoved &gt; <span class="hljs-number">0</span>)
            System.arraycopy(elementData, index+<span class="hljs-number">1</span>, elementData, index, numMoved);
        elementData[--size] = <span class="hljs-keyword">null</span>; <span class="hljs-comment">// Let gc do its work</span>

        <span class="hljs-keyword">return</span> oldValue;
    &#125;


    <span class="hljs-comment">// å¿«é€Ÿåˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ </span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">fastRemove</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;

        <span class="hljs-comment">// ä¿®æ”¹modCount</span>
        modCount++;
        <span class="hljs-keyword">int</span> numMoved = size - index - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (numMoved &gt; <span class="hljs-number">0</span>)
            System.arraycopy(elementData, index+<span class="hljs-number">1</span>, elementData, index,
                             numMoved);
        elementData[--size] = <span class="hljs-keyword">null</span>; <span class="hljs-comment">// Let gc do its work</span>
    &#125;

    <span class="hljs-comment">// æ¸…ç©ºé›†åˆ</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-comment">// ä¿®æ”¹modCount</span>
        modCount++;

        <span class="hljs-comment">// Let gc do its work</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; size; i++)
            elementData[i] = <span class="hljs-keyword">null</span>;

        size = <span class="hljs-number">0</span>;
    &#125;

    ...
&#125;</code></pre>

<p>ä»ä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼šæ— è®ºæ˜¯add()ã€remove()ï¼Œè¿˜æ˜¯clear()ï¼Œåªè¦æ¶‰åŠåˆ°ä¿®æ”¹é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°æ—¶ï¼Œéƒ½ä¼šæ”¹å˜modCountçš„å€¼ã€‚</p>
<p><strong>å› æ­¤</strong>ï¼Œåœ¨iteratoréå†ä¸­ï¼Œæ‰§è¡Œaddã€removeã€clearç­‰æ–¹æ³•ï¼Œä¼šæ”¹å˜modCountçš„å€¼ï¼Œä»è€Œä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ï¼Œäº§ç”Ÿfail-fastäº‹ä»¶ã€‚</p>
<p>åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜ï¼š</p>
<img src="/images/fail-fastå’Œfail-safe/image-20201227182712771.png" srcset="/img/loading.gif" alt="image-20201227182712771" style="zoom:80%;" />

<p><strong>ç«Ÿç„¶ä¸æŠ¥é”™ï¼Ÿï¼ŸçœŸæ˜¯ç™¾æ€ä¸å¾—å…¶è§£ï¼Œæœ€ååœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°äº†ç›¸å…³çš„å›ç­”ã€‚</strong></p>
<p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å‘ç°åªæœ‰next()ã€remove()æ—¶æ‰ä¼šæ£€æŸ¥exceptedMoCountå’ŒmodCountçš„å€¼ã€‚è€Œåªè¦æ¶‰åŠæ”¹å˜é›†åˆå…ƒç´ çš„æ“ä½œmodCountéƒ½ä¼šå˜åŒ–ï¼Œè€ŒexceptedModCountåœ¨åˆå§‹åŒ–ä¹‹åå°±ä¸å˜äº†ã€‚</p>
<p>åŸºäºè¿™äº›ç»“è®ºï¼Œæˆ‘ä»¬å†æ¥åˆ†æè¿™æ®µä»£ç ï¼Œå…¶å®è¿™é‡Œä¸æŠ¥å¼‚å¸¸çš„é—®é¢˜åœ¨äºhasNext()æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹æºç ï¼š</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasNext</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> cursor != size;
&#125;</code></pre>

<p>å…¶ä¸­ï¼Œcursorçš„æ„æ€æ˜¯ï¼Œindex of next elementï¼Œä¸‹ä¸€ä¸ªè¦éå†å…ƒç´ çš„ä¸‹æ ‡.</p>
<p>å½“è¿è¡Œå®Œlist1.remove(integer)//integer=20è¿™è¡Œä»£ç ä¹‹åï¼Œå¾ˆæ˜æ˜¾ï¼Œsize=2,cursor=2ï¼Œå¯¼è‡´äº†hasNext()è¿”å›falseï¼Œç»“æŸäº†å¾ªç¯ã€‚å› æ­¤ï¼Œæ˜¯å› ä¸ºhasNext()è¿”å›äº†falseä½¿å¾—æå‰ç»“æŸäº†å¾ªç¯ï¼Œè¿˜æ²¡æœ‰è¿è¡Œåˆ°next()æ–¹æ³•ï¼Œæ‰€ä»¥æ²¡æœ‰æŠ¥ConcurrentModificationExceptionå¼‚å¸¸ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜çœ‹åˆ°äº†ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„é—®é¢˜ï¼ŒArrayListæœ‰ä¸¤ä¸ªremoveæ–¹æ³•ï¼Œ</p>
<pre><code class="hljs java"><span class="hljs-function">E <span class="hljs-title">remove</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>
<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">remove</span><span class="hljs-params">(Object o)</span></span></code></pre>

<p>å½“å‚æ•°æ˜¯Integeræ—¶ä¼šè°ƒç”¨å“ªä¸ªï¼Ÿ æˆ‘åœ¨JLSä¸­æ‰¾åˆ°è¿™ä¹ˆä¸€æ®µï¼Œæ„æ€æ˜¯é€‰æ‹©é‡è½½å‡½æ•°æ—¶ä¸ä¼šä¼˜å…ˆè€ƒè™‘è£…ç®±è·Ÿæ‹†ç®±:</p>
<p>The first phase (<a href="https://link.zhihu.com/?target=http://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html%23jls-15.12.2.2">Â§15.12.2.2</a>) performs overload resolution without permitting boxing or unboxing conversion, or the use of variable arity method invocation. If no applicable method is found during this phase then processing continues to the second phase.</p>
<p>æˆ‘çš„ç†è§£æ˜¯ï¼Œåº”è¯¥æ˜¯ç›´æ¥è°ƒç”¨ç¬¬äºŒä¸ªå‡½æ•°çš„ã€‚</p>
<p>é¿å…æŠ›å¼‚å¸¸çš„è§£å†³æ–¹æ³•ï¼š</p>
<img src="/images/fail-fastå’Œfail-safe/image-20201227184803512.png" srcset="/img/loading.gif" alt="image-20201227184803512" style="zoom:80%;" />

<p>æ–¹æ³•å°±æ˜¯ä½¿ç”¨iteratorè‡ªå¸¦çš„remove()æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ²¡é—®é¢˜å‘¢ï¼Ÿæ˜¯å› ä¸ºè¯¥removeæ–¹æ³•å¹¶ä¸ä¼šä¿®æ”¹modCountçš„å€¼ï¼Œå¹¶ä¸”ä¸ä¼šå¯¹åé¢çš„éå†é€ æˆå½±å“ï¼Œå› ä¸ºè¯¥æ–¹æ³•removeä¸èƒ½æŒ‡å®šå…ƒç´ ï¼Œåªèƒ½removeå½“å‰éå†è¿‡çš„é‚£ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥è°ƒç”¨è¯¥æ–¹æ³•å¹¶ä¸ä¼šå‘ç”Ÿfail-fastç°è±¡ã€‚è¯¥æ–¹æ³•æœ‰å±€é™æ€§ã€‚</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">if</span> (lastRet &lt; <span class="hljs-number">0</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException();
    checkForComodification();

    <span class="hljs-keyword">try</span> &#123;
        ArrayList.<span class="hljs-keyword">this</span>.remove(lastRet);
        cursor = lastRet;
        lastRet = -<span class="hljs-number">1</span>;
        expectedModCount = modCount;<span class="hljs-comment">//åŒå¿—ä»¬ï¼Œçœ‹åˆ°äº†å—ï¼Ÿï¼è¿™å„¿ï¼Œæ²¡å˜ï¼</span>
    &#125; <span class="hljs-keyword">catch</span> (IndexOutOfBoundsException ex) &#123;
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConcurrentModificationException();
    &#125;
&#125;</code></pre>

<p>è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯ï¼š</p>
<p>ä½¿ç”¨javaå¹¶å‘åŒ…(java.util.concurrent)ä¸­çš„ç±»æ¥ä»£æ›¿ ArrayList å’ŒhashMapã€‚</p>
<p>æ¯”å¦‚ä½¿ç”¨ CopyOnWriterArrayListä»£æ›¿ ArrayListï¼Œ CopyOnWriterArrayListåœ¨æ˜¯ä½¿ç”¨ä¸Šè·Ÿ ArrayListå‡ ä¹ä¸€æ ·ï¼Œ CopyOnWriteræ˜¯å†™æ—¶å¤åˆ¶çš„å®¹å™¨(COW)ï¼Œåœ¨è¯»å†™æ—¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è¯¥å®¹å™¨åœ¨å¯¹addå’Œremoveç­‰æ“ä½œæ—¶ï¼Œå¹¶ä¸æ˜¯åœ¨åŸæ•°ç»„ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œè€Œæ˜¯å°†åŸæ•°ç»„æ‹·è´ä¸€ä»½ï¼Œåœ¨æ–°æ•°ç»„ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œå¾…å®Œæˆåï¼Œæ‰å°†æŒ‡å‘æ—§æ•°ç»„çš„å¼•ç”¨æŒ‡å‘æ–°æ•°ç»„ï¼Œæ‰€ä»¥å¯¹äº CopyOnWriterArrayListåœ¨è¿­ä»£è¿‡ç¨‹å¹¶ä¸ä¼šå‘ç”Ÿfail-fastç°è±¡ã€‚ä½† CopyOnWriteå®¹å™¨åªèƒ½ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¸èƒ½ä¿è¯æ•°æ®çš„å®æ—¶ä¸€è‡´æ€§ã€‚</p>
<p>å¯¹äºHashMapï¼Œå¯ä»¥ä½¿ç”¨ConcurrentHashMapï¼Œ ConcurrentHashMapé‡‡ç”¨äº†é”æœºåˆ¶ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨è¿­ä»£æ–¹é¢ï¼ŒConcurrentHashMapä½¿ç”¨äº†ä¸€ç§ä¸åŒçš„è¿­ä»£æ–¹å¼ã€‚åœ¨è¿™ç§è¿­ä»£æ–¹å¼ä¸­ï¼Œå½“iteratorè¢«åˆ›å»ºåé›†åˆå†å‘ç”Ÿæ”¹å˜å°±ä¸å†æ˜¯æŠ›å‡ºConcurrentModificationExceptionï¼Œå–è€Œä»£ä¹‹çš„æ˜¯åœ¨æ”¹å˜æ—¶newæ–°çš„æ•°æ®ä»è€Œä¸å½±å“åŸæœ‰çš„æ•°æ® ï¼Œiteratorå®Œæˆåå†å°†å¤´æŒ‡é’ˆæ›¿æ¢ä¸ºæ–°çš„æ•°æ® ï¼Œè¿™æ ·iteratorçº¿ç¨‹å¯ä»¥ä½¿ç”¨åŸæ¥è€çš„æ•°æ®ï¼Œè€Œå†™çº¿ç¨‹ä¹Ÿå¯ä»¥å¹¶å‘çš„å®Œæˆæ”¹å˜ã€‚å³è¿­ä»£ä¸ä¼šå‘ç”Ÿfail-fastï¼Œä½†ä¸ä¿è¯è·å–çš„æ˜¯æœ€æ–°çš„æ•°æ®ã€‚</p>
<p>CopyOnWriterArrayListæºç ï¼š</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> java.util.concurrent;
<span class="hljs-keyword">import</span> java.util.*;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.*;
<span class="hljs-keyword">import</span> sun.misc.Unsafe;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CopyOnWriteArrayList</span>&lt;<span class="hljs-title">E</span>&gt;</span>
<span class="hljs-class">    <span class="hljs-keyword">implements</span> <span class="hljs-title">List</span>&lt;<span class="hljs-title">E</span>&gt;, <span class="hljs-title">RandomAccess</span>, <span class="hljs-title">Cloneable</span>, <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span> </span>&#123;

    ...

    <span class="hljs-comment">// è¿”å›é›†åˆå¯¹åº”çš„è¿­ä»£å™¨</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Iterator&lt;E&gt; <span class="hljs-title">iterator</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> COWIterator&lt;E&gt;(getArray(), <span class="hljs-number">0</span>);
    &#125;

    ...

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">COWIterator</span>&lt;<span class="hljs-title">E</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">ListIterator</span>&lt;<span class="hljs-title">E</span>&gt; </span>&#123;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object[] snapshot;

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> cursor;

        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">COWIterator</span><span class="hljs-params">(Object[] elements, <span class="hljs-keyword">int</span> initialCursor)</span> </span>&#123;
            cursor = initialCursor;
            <span class="hljs-comment">// æ–°å»ºCOWIteratoræ—¶ï¼Œå°†é›†åˆä¸­çš„å…ƒç´ ä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„æ‹·è´æ•°ç»„ä¸­ã€‚</span>
            <span class="hljs-comment">// è¿™æ ·ï¼Œå½“åŸå§‹é›†åˆçš„æ•°æ®æ”¹å˜ï¼Œæ‹·è´æ•°æ®ä¸­çš„å€¼ä¹Ÿä¸ä¼šå˜åŒ–ã€‚</span>
            snapshot = elements;
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasNext</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">return</span> cursor &lt; snapshot.length;
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasPrevious</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">return</span> cursor &gt; <span class="hljs-number">0</span>;
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">next</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">if</span> (! hasNext())
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();
            <span class="hljs-keyword">return</span> (E) snapshot[cursor++];
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">previous</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">if</span> (! hasPrevious())
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();
            <span class="hljs-keyword">return</span> (E) snapshot[--cursor];
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">nextIndex</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">return</span> cursor;
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">previousIndex</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">return</span> cursor-<span class="hljs-number">1</span>;
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnsupportedOperationException();
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set</span><span class="hljs-params">(E e)</span> </span>&#123;
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnsupportedOperationException();
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span> </span>&#123;
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnsupportedOperationException();
        &#125;
    &#125;

    ...

&#125;</code></pre>

<p>æ ¹æ®æºç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š</p>
<ul>
<li>å’ŒArrayListç»§æ‰¿äºAbstractListä¸åŒï¼ŒCopyOnWriteArrayListæ²¡æœ‰ç»§æ‰¿äºAbstractListï¼Œå®ƒä»…ä»…åªæ˜¯å®ç°äº†Listæ¥å£</li>
<li>ArrayListçš„iterator()å‡½æ•°è¿”å›çš„Iteratoræ˜¯åœ¨AbstractListä¸­å®ç°çš„ï¼›è€ŒCopyOnWriteArrayListæ˜¯è‡ªå·±å®ç°Iteratorã€‚</li>
<li>ArrayListçš„Iteratorå®ç°ç±»ä¸­è°ƒç”¨next()æ—¶ï¼Œä¼šâ€œè°ƒç”¨checkForComodification()æ¯”è¾ƒâ€˜expectedModCountâ€™å’Œâ€˜modCountâ€™çš„å¤§å°â€ï¼›ä½†æ˜¯ï¼ŒCopyOnWriteArrayListçš„Iteratorå®ç°ç±»ä¸­ï¼Œæ²¡æœ‰æ‰€è°“çš„checkForComodification()ï¼Œæ›´ä¸ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ï¼ </li>
</ul>
<h2 id="2-fail-safe"><a href="#2-fail-safe" class="headerlink" title="2. fail-safe"></a>2. fail-safe</h2><p>//to be continued</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/01/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91%E5%BF%85%E5%A4%87%E6%A1%86%E6%9E%B6%E2%80%94%E2%80%94Hadoop/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">å¤§æ•°æ®å¼€å‘å¿…å¤‡æ¡†æ¶â€”â€”hadoop(æŒç»­æ›´æ–°ä¸­)</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/12/27/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF%EF%BC%88%E4%B8%8D%E6%96%AD%E4%BF%AE%E6%94%B9%EF%BC%89/">
                        <span class="hidden-mobile">å¤§æ•°æ®å­¦ä¹ è·¯çº¿ï¼ˆJavaæ–¹å‘ï¼‰ï¼ˆä¸æ–­æ›´æ­£ä¸­ï¼‰</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":200})
    NProgress.start()
    document.addEventListener('DOMContentLoaded', function() {
      window.NProgress && window.NProgress.inc();
    })
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js" ></script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>


  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?7d2fd3d56f2287a0bda354d214258de6";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>



</body>
</html>
